@model EasyGames.ViewModels.PosOrdersIndexVm
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<h1 class="mb-3">POS Orders</h1>

<form method="get" class="row g-2 align-items-end mb-3">
  <div class="col-auto">
    <label class="form-label" for="shopId">Shop</label>
    <select id="shopId" name="shopId" class="form-select" onchange="this.form.submit()">
      @foreach (var s in Model.UserShops)
      {
          <option value="@s.ShopId" selected="@(s.ShopId == Model.SelectedShop.ShopId ? "selected" : null)">@s.Name</option>
      }
    </select>
  </div>

  <div class="col-auto">
    <label class="form-label" for="q">Search</label>
    <input id="q" name="q" value="@Model.Q" class="form-control" placeholder="Order #, name, email, phone" />
  </div>

  <div class="col-auto">
    <label class="form-label" for="status">Status</label>
    <select id="status" name="status" class="form-select">
      <option value="">All</option>
      @foreach (var s in EasyGames.Models.OrderStatuses.All)
      {
          <option value="@s" selected="@(Model.Status == s ? "selected" : null)">@s</option>
      }
    </select>
  </div>

  <div class="col-auto">
    <label class="form-label" for="from">From</label>
    <input id="from" name="from" type="date" value="@(Model.From?.ToString("yyyy-MM-dd"))" class="form-control" />
  </div>

  <div class="col-auto">
    <label class="form-label" for="to">To</label>
    <input id="to" name="to" type="date" value="@(Model.To?.ToString("yyyy-MM-dd"))" class="form-control" />
  </div>

  <div class="col-auto">
    <label class="form-label" for="sort">Sort</label>
    <select id="sort" name="sort" class="form-select">
      <option value="newest" selected="@(Model.Sort=="newest"?"selected":null)">Newest</option>
      <option value="oldest" selected="@(Model.Sort=="oldest"?"selected":null)">Oldest</option>
      <option value="total"  selected="@(Model.Sort=="total" ?"selected":null)">Total</option>
    </select>
  </div>

  <div class="col-auto">
    <label class="form-label d-block">&nbsp;</label>
    <button class="btn btn-primary">Filter</button>
  </div>
</form>

@if (Model.Items.Count == 0)
{
    <div class="alert alert-info">No orders match your filters.</div>
}
else
{
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>#</th>
            <th>Date</th>
            <th>Customer</th>
            <th>Status</th>
            <th class="text-end">Total</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          @foreach (var o in Model.Items)
          {
              <tr>
                <td>@o.Id</td>
                <td>@o.CreatedUtc.ToLocalTime().ToString("yyyy-MM-dd HH:mm")</td>
                <td>
                  @if (!string.IsNullOrWhiteSpace(o.User?.FullName))
                  { <span>@o.User.FullName</span> }
                  else
                  { <span>@o.User?.Email</span> }
                </td>
                <td>@o.Status</td>
                <td class="text-end">@o.GrandTotal.ToString("C")</td>
                <td class="text-end">
                  <a class="btn btn-sm btn-outline-secondary"
                     asp-action="Details"
                     asp-route-id="@o.Id"
                     asp-route-shopId="@Model.SelectedShop.ShopId">
                    View
                  </a>
                </td>
              </tr>
          }
        </tbody>
      </table>
    </div>
        var lastPage = (int)Math.Ceiling((double)Model.TotalCount / Model.PageSize);
    <nav class="d-flex justify-content-between align-items-center">
      <div>Showing page @Model.Page of @lastPage (@Model.TotalCount total)</div>
      <div class="btn-group">
        <a class="btn btn-outline-secondary @(Model.Page<=1?"disabled":"")"
           asp-route-shopId="@Model.SelectedShop.ShopId"
           asp-route-q="@Model.Q"
           asp-route-status="@Model.Status"
           asp-route-from="@Model.From?.ToString("yyyy-MM-dd")"
           asp-route-to="@Model.To?.ToString("yyyy-MM-dd")"
           asp-route-sort="@Model.Sort"
           asp-route-page="@(Model.Page-1)"
           asp-route-pageSize="@Model.PageSize">Prev</a>

        <a class="btn btn-outline-secondary @(Model.Page>=lastPage?"disabled":"")"
           asp-route-shopId="@Model.SelectedShop.ShopId"
           asp-route-q="@Model.Q"
           asp-route-status="@Model.Status"
           asp-route-from="@Model.From?.ToString("yyyy-MM-dd")"
           asp-route-to="@Model.To?.ToString("yyyy-MM-dd")"
           asp-route-sort="@Model.Sort"
           asp-route-page="@(Model.Page+1)"
           asp-route-pageSize="@Model.PageSize">Next</a>
      </div>
    </nav>
}
